@{
    ViewData["Title"] = "User Administration";
}

@model UsersViewModel
<!--Breadcrumb navigation-->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a class="text-white" asp-controller="Home" asp-action="Index">Home</a></li>
        <li class="breadcrumb-item active text-white" aria-current="page">User Administration</li>
    </ol>
</nav>

<div class="container-fluid">

    <h3>@ViewData["Title"]</h3>
    <div class="row mb-4">
        <div class="col">
            <a class="btn" asp-controller="UserAdmin" asp-action="CreateUser">
                <i class="fas fa-plus-circle fa-lg"></i> Add User
            </a>
        </div>
    </div>

    <h5>Active User Accounts</h5>
    <table class="table table-striped">
        <thead class="">
        <tr>
            <th scope="col">Username</th>
            <th scope="col">Lastname</th>
            <th scope="col">Firstname</th>
            <th scope="col">Job Description</th>
            <th scope="col">Role</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody class="bg-white">
        <!-- Loop to print out the user accounts -->
        @for (int i = 0; i < Model?.ActiveUserAccounts?.Count; i++)
        {
            <tr>
                <td>@Model.ActiveUserAccounts[i].Username</td>
                <td>@Model.ActiveUserAccounts[i].Lastname</td>
                <td>@Model.ActiveUserAccounts[i].Firstname</td>
                <td>@Model.ActiveUserAccounts[i].JobDescription.Description</td>
                <td>@Model.ActiveUserAccounts[i].JobDescription.Role</td>
                <td>
                    <a class="btn-sm" asp-action="ResetPassword" asp-route-id="@Model.ActiveUserAccounts[i].Id">
                        <i class="fas fa-key fa-lg" title="Reset Password"></i>
                    </a>
                    <a class="btn-sm" asp-action="EditUser" asp-route-id="@Model.ActiveUserAccounts[i].Id">
                        <i class="fas fa-user-edit fa-lg" title="Edit User"></i>
                    </a>
                    <a class="btn-sm" data-toggle="modal" data-target="#deleteuser" data-id="@Model.ActiveUserAccounts[i].Id" data-username="@Model.ActiveUserAccounts[i].Username">
                        <i class="fas fa-user-alt-slash fa-lg" title="Delete User"></i>
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>
    
    <h5>Inactive User Accounts</h5>
    <table class="table table-striped">
        <thead class="">
        <tr>
            <th scope="col">Username</th>
            <th scope="col">Job Description</th>
            <th scope="col">Role</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody class="bg-white">
        <!-- Loop to print out the user accounts -->
        @for (int i = 0; i < Model?.InactiveUserAccounts?.Count; i++)
        {
            <tr>
                <td>@Model.InactiveUserAccounts[i].Username</td>
                <td>@Model.InactiveUserAccounts[i].JobDescription.Description</td>
                <td>@Model.InactiveUserAccounts[i].JobDescription.Role</td>
                <td>
                    <a class="btn-sm" asp-action="ResetPassword" asp-route-id="@Model.InactiveUserAccounts[i].Id">
                        <i class="fas fa-key fa-lg" title="Reset Password"></i>
                    </a>
                    <a class="btn-sm" asp-action="EditUser" asp-route-id="@Model.InactiveUserAccounts[i].Id">
                        <i class="fas fa-user-edit fa-lg" title="Edit User"></i>
                    </a>
                    <a class="btn-sm" data-toggle="modal" data-target="#deleteuser" data-id="@Model.InactiveUserAccounts[i].Id" data-username="@Model.InactiveUserAccounts[i].Username">
                        <i class="fas fa-user-alt-slash fa-lg" title="Delete User"></i>
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>
    
    <h5>Deleted User Accounts</h5>
    <table class="table table-striped">
        <thead class="">
        <tr>
            <th scope="col">Username</th>
            <th scope="col">Job Description</th>
            <th scope="col">Role</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody class="bg-white">
        <!-- Loop to print out the user accounts -->
        @for (int i = 0; i < Model?.InactiveUserAccounts?.Count; i++)
        {
            <tr>
                <td>@Model.DeletedUserAccounts[i].Username</td>
                <td>@Model.DeletedUserAccounts[i].JobDescription.Description</td>
                <td>@Model.DeletedUserAccounts[i].JobDescription.Role</td>
                <td>
                    <a class="btn-sm" asp-action="EditUser" asp-route-id="@Model.DeletedUserAccounts[i].Id">
                        <i class="fas fa-user-edit fa-lg" title="Edit User"></i>
                    </a>
                    <a class="btn-sm" data-toggle="modal" data-target="#deleteuser" data-id="@Model.DeletedUserAccounts[i].Id" data-username="@Model.InactiveUserAccounts[i].Username">
                        <i class="fas fa-user-alt-slash fa-lg" title="Delete User"></i>
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>

<div class="modal fade" id="deleteuser" tabindex="-1" role="dialog" aria-labelledby="deleteuserLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteuserLabel">Delete User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="message-text"></p>
            </div>
            <div class="modal-footer">
                <form asp-action="DeleteUser">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <!-- hidden input for Id -->
                    <div id="deleteuser"></div>

                    <!-- Confirm Delete and cancel buttons-->
                    <div class="form-group mt-4">
                        <input type="submit" value="Confirm Delete" class="btn btn-red-confirm" />
                        <button type="button" class="btn btn-grey-cancel" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        $('#deleteuser').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var id = button.data('id') // Extract info from data-* attributes
            var name = button.data('username')
            var modal = $(this)
            modal.find('.modal-title').text('Confirm Delete User')
            modal.find('.modal-body #message-text').text('Are you sure you want to delete the user: \"' + name + '\" (Id:' + id + ')')
            modal.find('.modal-footer #deleteuser').html('<input type="hidden" class="form-control" data-val="true" data-val-required="The Id field is required." id="Id" name="Id" value="' + id + '" />')
        })
    </script>

}

@section Head{
    <meta http-equiv="refresh" content="60">
}